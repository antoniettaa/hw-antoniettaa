---
title: "Exercises: Multivariate pivoting"
output: 
  html_document:
    theme: paper
---

Class notes:

names_sep = "_" ; underscores _ splits 

values = where it sends the cell values to 

cols = what columns do we want to make? 



```{r}

who%>%pivot_longer(
cols = new_sp_m_014:new_ep_f_65,
names_to = c("diagnosis","gender","age"),
names_prefix = "new_",
names_sep = "_",
values_to = "count")

```

```{r}

fam_dat%>%
  pivot_longer(
    cols = -family, 
    names_to = c(".value", "child"), # whatever value is in that position, it will make that the name of the column -> make a column using whatever text is in the slot 
    names_sep = "_", #how to break up the column name that are being pivoted 
    values_drop_na = TRUE
  ) %>%
  mutate(child = stringr:: str_replace(child, "child", "")) %>%
  mutate(child = as.integer(child))

fam_dat%>%
  pivot_wider( id_cols = family, 
               names_from = child,
               names_prefix = "child",
               names_sep + "_",
               values_from = c(dob, gender))


```


```{r}
library(tidyverse)
set.seed(123)
missing_w2_parent <- sample(1:500, 30)
missing_w2_child <- c(missing_w2_parent[1:5], sample(1:500, 25))
family  <- read_csv(
  "https://raw.githubusercontent.com/bwiernik/progdata/main/inst/tutorials/data/family_data.csv"
) %>% 
  mutate(
    across(
      starts_with("w2") & contains("parent"),
      ~ ifelse(family_id %in% missing_w2_parent, NA_real_, .x)
    ),
    across(
      starts_with("w2") & contains("child"),
      ~ ifelse(family_id %in% missing_w2_child, NA_real_, .x)
    )
  )
```

<!---The following chunk allows errors when knitting--->

```{r allow errors, echo = FALSE}
knitr::opts_chunk$set(error = TRUE, warning = FALSE)
```

You're working on a longitudinal study of parent-child relationships.
You have collected data from 500 families over 2 waves.
In each wave, both the child and parent completed measures of **communication behavior** and **relationship satisfaction**. 

```{r}
family %>% 
  DT::datatable(rownames = FALSE)
```

1. Reshape the dataset to a "longer" format.

  - Make each row **1 score**
  - Have columns for *family_id*, *family_member*, *wave*, *scale*, and *score*.

```{r}
family_longest <- family %>% 
  pivot_longer(
iris2
    cols = family_id, w1_comm_child, w1_comm_parent, w2_comm_child, w2_comm_parent,
    names_to = c(".value", "family_id"),
    names_sep = "_",
    values_drop_na = TRUE
    
  )

print(family_longest)
```

2. Reshape the dataset to a "longer" format.

  - Make each row **1 person**
  - Have columns for *family_id*, *family_member*, *wave*, *comm*, and *satis*.

```{r}
family_long <- family %>% 
  pivot_longer()

print(family_long)
```

3. Some families are missing wave 2 data for parent, child, or both. 
   Which families are missing wave 2 data for at least one person?

```{r}

```

Question: Is is easier to easier to find the missing data in the wide or long format?
